<div  style="margin-top: 20px; margin-left: 45px">

 <mp-workspace-layout horizontal-collapsed-size=0>
          <mp-workspace-row>
            <mp-workspace-item id='1' default-size=550>
                <div class='grid-demo' style='flex: 1;  width:500px'>
                  <h2>Search over Tasks & Methods</h2>
                  <semantic-simple-search
                    query='{
                      "type": "sparql",
                      "query": "SELECT DISTINCT ?resource ?label WHERE {
                                SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                {
                                  ?resource a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Task> .
                                  BIND ( STRAFTER (STR(?resource), \"http://scholkg.kmi.open.ac.uk/aikg/resource/\") AS ?label)
                                  FILTER REGEX(LCASE(STRAFTER (STR(?resource), \"http://scholkg.kmi.open.ac.uk/aikg/resource/\") ), LCASE(?__token__), \"i\")
                                } 
                              } ORDER BY DESC (?score) (?label) LIMIT 10",
                      "params": {
                        "__token__": {
                          "type": "token",
                          "required": true
                        }
                      }
                    }'
                    template='{{> search-template}}'
                    input-placeholder='Search for something e.g. "communication"'
                  >
                    <template id="search-template">
                      <mp-event-trigger type="Component.TemplateUpdate" targets='["event-target"]' data='{"item": "<{{iri}}>"}'>
                        <span style="color: blue;">{{label.value}}</span>
                      </mp-event-trigger>
                    </template>
                  </semantic-simple-search>  




                  <semantic-search>
                    <semantic-search-query-keyword
                      query='
                        SELECT DISTINCT ?resource ?label WHERE {
                          SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>
                          {
                            ?resource a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Task> .
                            BIND ( STRAFTER (STR(?resource), "http://scholkg.kmi.open.ac.uk/aikg/resource/") AS ?label)
                            FILTER REGEX(LCASE(STRAFTER (STR(?resource), "http://scholkg.kmi.open.ac.uk/aikg/resource/") ), LCASE(?__token__), "i")
                          } 
                        } ORDER BY DESC (?score) (?label) LIMIT 10
                      '
                    ></semantic-search-query-keyword>

                    <semantic-search-result-holder>
                      <semantic-search-result>
                        <semantic-table
                          id='overall-search-table'
                          query='SELECT ?resource ?label WHERE {?resource rdfs:label ?label}'
                          tuple-template='{{>resultTemplate}}'
                          options='{"showFilter": false}'
                        >
                          <template id='resultTemplate'>
                            <mp-event-trigger type="Component.TemplateUpdate" targets='["event-target"]' data='{"item": "<{{iri}}>"}'>
                              <span style="color: blue;">{{label.value}}</span>
                            </mp-event-trigger>
                          </template>
                        </semantic-table>
                      </semantic-search-result>
                    </semantic-search-result-holder>
                  </semantic-search>






               
                  <h2>KMI AI-KG Tasks</h2>
                  <div style="padding: 20px; margin: 20px;height:500px; background-color: #f7f7f7; border: 1px solid #e8e8e8;">
                  <semantic-lazy-tree
                                roots-query='SELECT DISTINCT ?item ?hasChildren WHERE {
                                        SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                          {
                                            ?item a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Task>
                                            FILTER NOT EXISTS 
                                            { 
                                              ?a rdf:subject ?item ;
                                                 rdf:predicate skos:broader ;
                                                 rdf:object ?supertopic . 
                                            }  
                                            OPTIONAL 
                                            {
                                               ?b rdf:subject ?subtopic ;
                                                  rdf:predicate skos:broader ;
                                                  rdf:object ?item. 
                                            } 
                                             BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                          }
                                        }'

                                children-query='SELECT ?item ?hasChildren WHERE {
                                                SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                  ?c rdf:subject ?item ;
                                                     rdf:predicate skos:broader;
                                                     rdf:object ?parent . 
                                                  OPTIONAL 
                                                  { 
                                                    ?d rdf:subject ?subtopic ;
                                                       rdf:predicate skos:broader ;
                                                       rdf:object ?item . 
                                                  }
                                                  BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                                } }'
                                node-template='{{> node}}'

                                search-query='SELECT DISTINCT ?item ?label ?score ?hasChildren WHERE {
                                               SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                  ?item a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Task> .
                                                  BIND ( STRAFTER (STR(?item), "http://scholkg.kmi.open.ac.uk/aikg/resource/") AS ?label)
                                                  BIND("false" AS ?hasChildren)
                                                  FILTER REGEX(LCASE(STRAFTER (STR(?item), "http://scholkg.kmi.open.ac.uk/aikg/resource/") ), LCASE(?__token__), "i")
                                                } 
                                              } ORDER BY DESC (?score) (?label) LIMIT 50
                                            '
                                placeholder='Select or search for a task..'
                                parents-query='SELECT ?item ?parent ?hasChildren WHERE {
                                                SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                     ?e rdf:subject ?item ;
                                                        rdf:predicate skos:broader ;
                                                        rdf:object ?parent . 
                                                OPTIONAL 
                                                  { 
                                                    ?d rdf:subject ?subtopic ;
                                                       rdf:predicate skos:broader ;
                                                       rdf:object ?item . 
                                                  }
                                                  BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                                }
                                               }'
                              >
                         <template id='node'>
                          
                              <mp-event-trigger type="Component.TemplateUpdate" targets='["event-target"]' data='{"item": "<{{iri}}>"}'>
                              <span>
                                {{label}} 
                              </span>
                              </mp-event-trigger>
                            
                          </template>
                        
                        
                        
                    </semantic-lazy-tree>
                    </div>

                       <hr>

                    <h2>KMI AI-KG Methods</h2>
                    <div style="padding: 20px; margin: 20px; height:500px; background-color: #f7f7f7; border: 1px solid #e8e8e8;">
                    <semantic-lazy-tree
                            roots-query='SELECT DISTINCT ?item ?hasChildren WHERE {
                                        SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                          {
                                            ?item a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Method>
                                            FILTER NOT EXISTS 
                                            { 
                                              ?a rdf:subject ?item ;
                                                 rdf:predicate skos:broader ;
                                                 rdf:object ?supertopic . 
                                            }  
                                            OPTIONAL 
                                            {
                                               ?b rdf:subject ?subtopic ;
                                                  rdf:predicate skos:broader ;
                                                  rdf:object ?item. 
                                            } 
                                             BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                          }
                                        }'

                                children-query='SELECT ?item ?hasChildren WHERE {
                                                SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                  ?c rdf:subject ?item ;
                                                     rdf:predicate skos:broader;
                                                     rdf:object ?parent . 
                                                  OPTIONAL 
                                                  { 
                                                    ?d rdf:subject ?subtopic ;
                                                       rdf:predicate skos:broader ;
                                                       rdf:object ?item . 
                                                  }
                                                  BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                                } }'
                                node-template='{{> node2}}'

                                search-query='SELECT DISTINCT ?item ?label ?score ?hasChildren WHERE {
                                               SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                  ?item a <http://scholkg.kmi.open.ac.uk/aikg/ontology#Method> .
                                                  BIND ( STRAFTER (STR(?item), "http://scholkg.kmi.open.ac.uk/aikg/resource/") AS ?label)
                                                  BIND("false" AS ?hasChildren)
                                                  FILTER REGEX(LCASE(STRAFTER (STR(?item), "http://scholkg.kmi.open.ac.uk/aikg/resource/") ), LCASE(?__token__), "i")
                                                } 
                                              } ORDER BY DESC (?score) (?label) LIMIT 50
                                            '
                                placeholder='Select or search for a task..'
                                parents-query='SELECT ?item ?parent ?hasChildren WHERE {
                                                SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                                {
                                                     ?e rdf:subject ?item ;
                                                        rdf:predicate skos:broader ;
                                                        rdf:object ?parent . 
                                                OPTIONAL 
                                                  { 
                                                    ?d rdf:subject ?subtopic ;
                                                       rdf:predicate skos:broader ;
                                                       rdf:object ?item . 
                                                  }
                                                  BIND (IF(BOUND(?subtopic), "true", "false") AS ?hasChildren) 
                                                }
                                               }'
                                                >
                          <template id='node2'>
                          
                              <mp-event-trigger type="Component.TemplateUpdate" targets='["event-target"]' data='{"item": "<{{iri}}>"}'>
                              <span>
                                {{label}} 
                              </span>
                              </mp-event-trigger>
                            
                          </template>
                          
                          
                          
                      </semantic-lazy-tree>
                    </div>
                </div>
              </mp-workspace-item>
            <mp-workspace-item id='2'>
              <div class='grid-demo' style='flex: 1; padding: 20px'>
               <mp-event-target-template-render id="event-target" template="{{> template}}">
                <template id="template">
                
               
                  <h2>Graph View</h2>
                  <div style="height:500px">
                     {{#if item}}
                   <div class='ontodia-container'  >
                      <div class='ontodia-workspace-container' style="height:500px" >
                        <ontodia query="PREFIX kmi: <http://scholkg.kmi.open.ac.uk/aikg/ontology#>
                                        CONSTRUCT {	 
                                        ?this skos:broader ?parent ;
                                              skos:narrower ?child .
                                        ?s ?p ?o .
                                        } 
                                        WHERE {
                                          SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                                          {
                                            # TODO: retrieve types
                                            # retrieve parents
                                            {
                                            ?b rdf:subject {{item}} ;
                                              rdf:predicate skos:broader ;
                                              rdf:object ?parent. 
                                            }
                                            # retrieve children
                                            UNION 
                                            {
                                            ?c rdf:subject ?child ;
                                              rdf:predicate skos:broader ;
                                              rdf:object {{item}}. 
                                            } 
                                            # -- ITEM IS TASK --
                                            # retrieve methods
                                            UNION 
                                            {
                                            ?d rdf:subject {{item}} ;
                                              rdf:predicate ?p ;
                                              rdf:object ?o. 
                                              {{item}} a kmi:Task .
                                              ?o a kmi:Method .
                                              BIND({{item}} as ?s)
                                            }
                                            # retrieve ingoing relations from methods (not needed as every predicate has inverse)
                                            #UNION 
                                            #{
                                            #?d rdf:subject ?s ;
                                            #  rdf:predicate ?p ;
                                            #  rdf:object {{item}}. 
                                            #  {{item}} a kmi:Task .
                                            #  ?s a kmi:Method .
                                            #  BIND({{item}} as ?o)
                                            #} 
                                            # -- ITEM IS METHOD --
                                            # retrieve tasks (if item is method)
                                            UNION 
                                            {
                                            ?d rdf:subject {{item}} ;
                                              rdf:predicate ?p ;
                                              rdf:object ?o. 
                                              {{item}} a kmi:Method .
                                              ?o a kmi:Task .
                                              BIND({{item}} as ?s)
                                            } 
                                            # retrieve ingoing relations from tasks (not needed as every predicate has inverse)
                                            #UNION 
                                            #{
                                            #?d rdf:subject ?s ;
                                            #  rdf:predicate ?p ;
                                            #  rdf:object {{item}}. 
                                            #  {{item}} a kmi:Method .
                                            #  ?s a kmi:Task .
                                            #  BIND({{item}} as ?o)
                                            #} 
                                          }
                                          BIND ({{item}} as ?this) 
                                        }"  >
                         </ontodia>
                      </div>
                      <div class='ontodia-knowledge-panel-container'>
                        <mp-event-proxy
                                        id='proxy-selection'
                                        on-event-type='Ontodia.ShowElementInfo'
                                        proxy-event-type='KnowledgePanel.Open'
                                        proxy-targets='[]'>
                        </mp-event-proxy>
                        <semantic-context repository='default'>
                          <mp-knowledge-panel-frame no-pin=true></mp-knowledge-panel-frame>
                        </semantic-context>
                      </div>
                    </div>
                  {{/if}}
                  </div>
                  <h2>Broader/Narrower topics</h2>
                  <div style="height:500px">
                     {{#if item}}
                  <semantic-tree
                      query="
                              SELECT ?node ?parent 
                              WHERE {
                              SERVICE <https://scholkg.kmi.open.ac.uk/sparqlendpoint/>      
                              {
                                {
                                  ?b rdf:subject {{item}} .
                                  ?b rdf:predicate skos:narrower. 
                                  ?b rdf:object ?node. 
                                  BIND ({{item}} as ?parent)
                                } 
                                UNION 
                                {
                                  ?n rdf:subject ?parent.
                                  ?n rdf:predicate skos:narrower. 
                                  ?n rdf:object {{item}} . 
                                  BIND ({{item}} as ?node) 
                                }
                              }
                              
                              } "
                      provider='d3-sankey'  
                      d3-tree-options='{"nodeWidth":300, "nodeHeight":100, "nodeLeftMargin": 5}'>
                  </semantic-tree>
                     {{/if}}
                  </div>

               
                 </mp-event-target-template-render>
                </template>
              </div>
            </mp-workspace-item>
           
          </mp-workspace-row>
        </mp-workspace-layout>




</div>